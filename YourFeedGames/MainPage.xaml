<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:skia="clr-namespace:SkiaSharp.Extended.UI.Controls;assembly=SkiaSharp.Extended.UI"
             x:Class="YourFeedGames.MainPage"
             xmlns:converters="clr-namespace:YourFeedGames.Converters"
             Title="Feed de Notícias">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:StringNotEmptyConverter x:Key="StringNotEmptyConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*,Auto" Padding="10">
        <!-- Barra superior com título e botões -->
        <Grid Grid.Row="0"
              RowDefinitions="Auto,Auto,Auto"
              ColumnDefinitions="*,Auto,Auto,Auto"
              Margin="0,0,0,10">

            <!-- Primeira linha: Título e botões de ação -->
            <Label Grid.Row="0" Grid.Column="0" 
                   Text="Your Feed Games" 
                   FontSize="Title" 
                   FontAttributes="Bold" 
                   VerticalOptions="Center" />

            <!-- Botão de Refresh -->
            <Grid Grid.Row="0" Grid.Column="1"
                  HorizontalOptions="Center"
                  VerticalOptions="Center">
                <skia:SKLottieView
                    Source="refresh.json"
                    RepeatCount="1"
                    HeightRequest="50"
                    WidthRequest="50"
                    HorizontalOptions="Center">
                    <skia:SKLottieView.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnRefreshClicked"/>
                    </skia:SKLottieView.GestureRecognizers>
                </skia:SKLottieView>
            </Grid>

            <!-- Botão de Hot News -->
            <Grid Grid.Row="0" Grid.Column="2"
                  HorizontalOptions="Center"
                  VerticalOptions="Center">
                <skia:SKLottieView
                    Source="fire2.json"
                    RepeatCount="-1"
                    HeightRequest="50"
                    WidthRequest="50"
                    HorizontalOptions="Center">
                    <skia:SKLottieView.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnHotNewsClicked"/>
                    </skia:SKLottieView.GestureRecognizers>
                </skia:SKLottieView>
            </Grid>

            <!-- Botão de Configurações -->
            <Grid Grid.Row="0" Grid.Column="3"
                  HorizontalOptions="Center"
                  VerticalOptions="Center">
                <skia:SKLottieView
                    Source="settings.json"
                    RepeatCount="1"
                    HeightRequest="50"
                    WidthRequest="50"
                    HorizontalOptions="Center">
                    <skia:SKLottieView.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnSettingsClicked"/>
                    </skia:SKLottieView.GestureRecognizers>
                </skia:SKLottieView>
            </Grid>

            <!-- Segunda linha: Picker -->
            <Picker Grid.Row="1" Grid.ColumnSpan="4"
                    x:Name="portalPicker"
                    Title="Filtrar por portal"
                    SelectedIndexChanged="OnPortalPickerSelectedIndexChanged"
                    HorizontalOptions="FillAndExpand"
                    Margin="0,10,0,0" />

            <!-- Terceira linha: Botão de Resumo -->
            <Button Grid.Row="2" Grid.ColumnSpan="4"
                    Text="📰 Resumo IA - 2 minutos de leitura"
                    Clicked="OnSummaryClicked"
                    BackgroundColor="{AppThemeBinding Light=#2196F3, Dark=#1976D2}"
                    TextColor="White"
                    FontSize="16"
                    FontAttributes="Bold"
                    CornerRadius="25"
                    HeightRequest="50"
                    HorizontalOptions="FillAndExpand"
                    Margin="0,15,0,5">
                <Button.Shadow>
                    <Shadow Brush="Gray"
                            Offset="0,2"
                            Radius="4"
                            Opacity="0.3" />
                </Button.Shadow>
            </Button>
        </Grid>

        <!-- Conteúdo principal -->
        <Grid Grid.Row="1">
            <!-- Container de loading -->
            <StackLayout x:Name="loadingContainer" 
                        IsVisible="False"
                        HorizontalOptions="Center"
                        VerticalOptions="Center"
                        Spacing="20">
                <ActivityIndicator x:Name="loadingIndicator"
                                   IsRunning="True" 
                                   Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource Secondary}}"
                                   HeightRequest="50"
                                   WidthRequest="50"/>

                <Label x:Name="loadingLabel" 
                       Text="Carregando feeds de notícias..." 
                       FontSize="16"
                       HorizontalOptions="Center"/>

                <ProgressBar x:Name="loadingProgress" 
                             Progress="0"
                             ProgressColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource Secondary}}"
                             WidthRequest="300"/>

                <Button x:Name="cancelLoadingButton" 
                        Text="Cancelar" 
                        Clicked="OnCancelLoadingClicked"
                        IsVisible="False"
                        HorizontalOptions="Center"/>
            </StackLayout>

            <!-- ScrollView com as notícias -->
            <ScrollView x:Name="feedScrollView">
                <CollectionView ItemsSource="{Binding NewsFeed}" 
                                EmptyView="Nenhuma notícia disponível no momento"
                                >
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <!-- Card estilo iOS/Material minimalista -->
                            <Grid BackgroundColor="{AppThemeBinding Light=White, Dark=#1C1C1E}"
                                  Padding="20">
                                
                                <!-- Background com borda sutil -->
                                <RoundRectangle Fill="{AppThemeBinding Light=White, Dark=#1C1C1E}"
                                               CornerRadius="12"
                                               Stroke="{AppThemeBinding Light=#F0F0F0, Dark=#2C2C2E}"
                                               StrokeThickness="1" />
                                
                                <!-- Sombra suave -->
                                <RoundRectangle Fill="Transparent"
                                               CornerRadius="12">
                                    <RoundRectangle.Shadow>
                                        <Shadow Brush="{AppThemeBinding Light=#10000000, Dark=#30000000}"
                                                Offset="0,2"
                                                Radius="8"
                                                Opacity="1" />
                                    </RoundRectangle.Shadow>
                                </RoundRectangle>

                                <!-- Conteúdo -->
                                <StackLayout Spacing="12" Margin="16">
                                    
                                    <!-- Título principal -->
                                    <Label Text="{Binding Title}" 
                                           FontSize="16" 
                                           FontFamily="SegoeUIBold"
                                           TextColor="{AppThemeBinding Light=#1D1D1F, Dark=#F2F2F7}"
                                           LineBreakMode="WordWrap"
                                           MaxLines="3" />

                                    <!-- Descrição -->
                                    <Label Text="{Binding Description}" 
                                           FontSize="14"
                                           TextColor="{AppThemeBinding Light=#6D6D80, Dark=#8E8E93}"
                                           IsVisible="{Binding Description, Converter={StaticResource StringNotEmptyConverter}}"
                                           LineBreakMode="TailTruncation"
                                           MaxLines="2"
                                           Margin="0,-4,0,0" />

                                    <!-- Footer com fonte e ações -->
                                    <Grid ColumnDefinitions="*,Auto,Auto" 
                                          ColumnSpacing="12"
                                          Margin="0,8,0,0">
                                        
                                        <!-- Fonte -->
                                        <Label Grid.Column="0"
                                               Text="{Binding Source}" 
                                               FontSize="12" 
                                               TextColor="{AppThemeBinding Light=#8E8E93, Dark=#6D6D80}"
                                               VerticalOptions="Center" />

                                        <!-- Botão Ler mais -->
                                        <Button Grid.Column="1"
                                                Text="📖"
                                                CommandParameter="{Binding Url}" 
                                                Clicked="OnReadMoreClicked"
                                                BackgroundColor="Transparent"
                                                TextColor="{AppThemeBinding Light=#007AFF, Dark=#0A84FF}"
                                                FontSize="16"
                                                WidthRequest="32"
                                                HeightRequest="32"
                                                CornerRadius="16"
                                                Padding="0" />

                                        <!-- Botão compartilhar minimalista -->
                                        <Button Grid.Column="2"
                                                Text="↗"
                                                CommandParameter="{Binding Url}" 
                                                Clicked="OnShareClicked"
                                                BackgroundColor="Transparent"
                                                TextColor="{AppThemeBinding Light=#FF6B35, Dark=#FF8A65}"
                                                FontSize="16"
                                                WidthRequest="32"
                                                HeightRequest="32"
                                                CornerRadius="16"
                                                Padding="0" />

                                    </Grid>
                                </StackLayout>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </ScrollView>
        </Grid>

        <!-- Barra de status inferior -->
        <Label x:Name="statusLabel"
               Grid.Row="2"
               Text=""
               FontSize="12"
               TextColor="Gray"
               Margin="0,10,0,0"
               HorizontalOptions="Center"/>
    </Grid>
</ContentPage>